<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8"/>
    <title>PDF Structure validation</title>
    <style>
      body {max-width: 60em; margin-left:auto;margin-right:auto}
      form {
	  margin: 1em; padding:.5em;
	  background-color: beige;
	  border-radius: 2em;
	  border: solid thick green;
      }
      #pdffile {
	  min-width:40%;
	  background-color: white;
	  padding:1em;
	  border: solid black thin;
	  border-radius: .5em;
      }
      #schemas  {
	  line-height:115%;
      }
    </style>
   </head>
  <body>
<h1>PDF Structure Tree Display and Validation</h1>


<h2 id="formheading">Upload Tagged PDF</h2>
<!--
    action="https://httpbin.org/post"
    action="https://texlive.net/cgi-bin/show-pdf-tags"
    action="https://texlive.net/cgi-bin/showtags"
  -->
<form method="post"
      enctype="multipart/form-data"
         action="https://texlive.net/cgi-bin/showtags2"
      id="pdfform"
      name="pdfform"
      >
<div style="margin: 1em;">
<label for="pdffile">Select PDF file: </label>
<input type="file" accept=".pdf,application/pdf" name="pdffile" id="pdffile"/>
<input type="hidden" name="pdfdoc" id="pdfdoc"/>
<input onclick="clearform()" type="button" value="clear"/>
</div>
<div style="margin: 1em;">
  <label for="followmap">Follow Role Map: </label>
 <input type="checkbox" checked name="followmap" id="followmap"/>
</div>
<div style="margin: 1em;">
  <label for="download">Download as document.xml: </label>
 <input type="checkbox"  name="download" id="download"/>
</div>
<div style="margin: 1em;" id="schemas">
<label for="schema">Validate as: </label><br/>
 <input name="schema" type="radio" checked id="schema-auto" value="latex-document-switch"/>
<label for="schema-auto">Auto</label><br/>
 <input name="schema" type="radio" id="schema2.0" value="document-pdf-ua2"/>
<label for="schema2.0">PDF2.0 WTPDF/UA-2</label><br/>
 <input name="schema" type="radio" id="schema1.7" value="document-pdf-ua1"/>
<label for="schema1.7">PDF1.7 UA-1</label><br/>
 <input name="schema" type="radio" id="schemalatex2.0" value="latex-document"/>
<label for="schemalatex2.0">LaTeX UA-2 namespace</label><br/>
 <input name="schema" type="radio" id="schemalatex1.7" value="latex-document17"/>
<label for="schemalatex1.7">LaTeX UA-1 namespace</label><br/>
 <input name="schema" type="radio" id="none" value="none"/>
<label for="none">None</label>
</div>
<details style="margin: 1em;" id="schemas">
<summary>PlantUML Settings</summary>

<table>
<tr><td><input name="maxdepth" type="text" id="maxdepth" value="100"/></td>
<td><label for="maxdepth">Max Depth</label> (<i>Show <b>...</b> for elements
below this depth</i>)</td></tr>
<tr><td><input name="maxsiblings" type="text" id="maxsiblings" value="100"/></td>
<td><label for="maxsiblings">Max Siblings</label> (<i>Show <b>...</b> for
  child elements after this many children</i>)</td></tr>
<tr><td><input name="RootElem" type="text" id="RootElem" value=""/></td>
<td><label for="RootElem">Root Element</label> (<i>Name of element at which to
start the tree display</i>)</td></tr>
<tr><td><input name="RootElemOcc" type="text" id="RootElemOcc" value="1"/></td>
<td><label for="RootElemOcc">Root Element Occurrence</label> (<i>Only show
the nth "root element"</i>)</td></tr>
<tr><td><input name="ElideElem" type="text" id="ElideElem" value=""/></td>
<td><label for="ElideElem">Elide Element Content</label> (<i>List of tag
  names, whose children replaced by <b>...</b></i>)</td></tr>
<tr><td><input name="OmitAtts" type="text" id="OmitAtts" value=""/></td>
<td><label for="OmitAtts">Omit Attributes</label> (<i>List of Attribute
  names to omit from the display</i>)</td></tr>
<tr><td><input name="maxattlength" type="text" id="maxattlength" value="20"/></td>
<td><label for="maxattlength">Max Attribute Length</label> (<i>Truncate
  long attribute values and append <b>...</b></i>)</td></tr>
<tr><td><input type="checkbox"  name="ShowEmptyAtts" id="ShowEmptyAtts"/></td>
<td><label for="ShowEmptyAtts">Show Empty Atts</label> (<i>Show Attributes
  with empty value</i>)</td></tr>
<table>
</details>
<div style="margin: 1em;">
  <button>Submit</button>
</div>
</form>


<h2 id="notes">Notes</h2>

<ul>
<li>
Select a tagged PDF file to upload.  Drag and drop the PDF file, or browse using the Browse button.
</li>								    
<li>By default the generated XML will follow any specified Role
Mappings so the generated elements should use names from the standard PDF specifications.
If the <b>Follow Role Map</b> option is unchecked, the generated elements will use the names
and namespaces specified in any locally defined Structure Elements. The LaTeX-Project Structure Elements
are declared in the schema used here, but other namespaces result in XML files that will not validate
to the supplied schema.</li>
<li>The default <b>Auto</b> schema automatically validates a document against
 the <b>PDF/UA-1</b> or <b>PDF/UA-2</b> schemas extended with <b>LaTeX</b> Namespace elements.
  You may instead select a specific schema, or <b>None</b> to suppress schema validation.</li>
<li>By default, the generated XML will be displayed by your browser. If you select the <b>Download</b>
  option, it will be downloaded as <code>document.xml</code> to your default download area.</li>
<li>The returned page will also provide a link to open the Structure Tree in PlantUML syntax at
  <a href="https://plantuml.com">PlantUML.com</a>. This is using a display format produced by
  the <a href="https://pdfa.org/">PDF Association</a>. As it is mainly inteded for small fragments of
  the tree to be included in documentation, this form offers several
  options to truncate the display, starting at a specific element, or
  eliding elements under various conditions.</li>
</ul>

<h2 id="sources">Sources</h2>
<p>This web version is intended for small illustrative examples only, and is provided as a free service.</p>
<p>We encourage use of a local installation to allow easier experimentation and to reduce load on this server.</p>
<p>The full sources are available under Open Source licences.</p>
<ul>
 <li><code>show-pdf-tags</code> is a Lua script that just requires the <code>texlua</code> executable that is included in all modern TeX distributions. Source and documentation are on <a href="https://github.com/latex3/pdf_structure">GitHub</a>.</li>
 <li>The Relax NG Schema are developed in the same GitHub repository as the Lua script, <a href="https://github.com/latex3/pdf_structure">GitHub</a>.</li>
 <li>Any Relax NG validator can be used (RNV and Emacs/nxml are used in development). This web form uses RNV available from <a href="http://ftp.davidashen.net/PreTI/RNV/">davidashen.net</a>.</li>
</ul>

<hr/>
<p>Copyright 2024â€“2025 LaTeX Project</p>


<!-- Stop an accidental drop loading the pdf file -->
<script>

 function clearform() {
   document.location.search="";
 }


let params = new URLSearchParams(document.location.search);
let docparam = params.get("doc");
let rncparam = params.get("rnc");
let maxdepth= params.get("maxdepth");
let maxsiblings= params.get("maxsiblings");
let RootElem= params.get("RootElem");
let RootElemOcc= params.get("RootElemOcc");
let ElideElem= params.get("ElideElem");
let OmitAtts= params.get("OmitAtts");
let maxattlength= params.get("maxattlength");
let ShowEmptyAtts= params.get("ShowEmptyAtts");

if (rncparam) {
    let sch=document.getElementById(rncparam);
    if(sch) sch.checked=true;
}

if (maxdepth) document.getElementById("maxdepth").value=maxdepth;
if (maxsiblings) document.getElementById("maxsiblings").value=maxsiblings;
if (RootElem) document.getElementById("RootElem").value=RootElem;
if (RootElemOcc) document.getElementById("RootElemOcc").value=RootElemOcc;
if (ElideElem) document.getElementById("ElideElem").value=ElideElem;
if (OmitAtts) document.getElementById("OmitAtts").value=OmitAtts;
if (maxattlength) document.getElementById("maxattlength").value=maxattlength;
if (ShowEmptyAtts=="yes") document.getElementById("ShowEmptyAtts").checked=true;


if (docparam) {
  let indoc=document.getElementById("pdfdoc");

  document.getElementById("pdffile").type="hidden";
  indoc.type="text";
  indoc.value=docparam;
} else {

window.addEventListener("dragover",function(e){
    e = e || event;
    e.dataTransfer.dropEffect = "move";
    e.preventDefault();
},false);
window.addEventListener("drop",function(e){
    e = e || event;
    e.preventDefault();
},false);

document.getElementById('pdffile').addEventListener("drop",function(e){
    e = e || event;
    if (e.dataTransfer.items && e.dataTransfer.items[0].type=="application/pdf") {
	e.stopPropagation();
    } else {
	e.preventDefault();
    }
  
},false);


}
</script>

</body>
</html>

